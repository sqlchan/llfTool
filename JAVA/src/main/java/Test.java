import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONArray;
import com.alibaba.fastjson.JSONObject;
import org.apache.commons.lang.StringUtils;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.HashMap;
import java.util.Map;

public class Test {
    public static void main(String[] args) {
        Map<String, Object> data = JSON.parseObject(ss, Map.class);
        Map<String, Object> baseMap = new HashMap<>();

        JSONArray analysisResultList = (JSONArray) JSON.toJSON(data.get("analysisResult"));
        JSONObject analysisResult = (JSONObject) analysisResultList.get(0);
        JSONArray targetList = analysisResult.getJSONArray("target");
        JSONObject targetAttrs = analysisResult.getJSONObject("targetAttrs");
        JSONObject transmission = targetAttrs.getJSONObject("transmission");
        baseMap.put("taskID",analysisResult.getString("taskID"));
        baseMap.put("regionIndexCode",targetAttrs.getString("regionIndexCode"));
        baseMap.put("areaCode",targetAttrs.getString("areaCode"));
        baseMap.put("taskIds",transmission.getString("taskIds"));
        //baseMap.put("recognitionSign",targetAttrs.getIntValue("recognitionSign"));
        baseMap.put("mainTaskId",targetAttrs.getString("mainTaskId"));
        //baseMap.put("videoStructure",targetAttrs.getIntValue("videoStructure"));
        //baseMap.put("crossingId",targetAttrs.getIntValue("crossingId"));
        baseMap.put("cameraIndexCode",targetAttrs.getString("cameraIndexCode"));
        baseMap.put("analysisType",targetAttrs.getString("analysisType"));
        //baseMap.put("timeZone",targetAttrs.getIntValue("timeZone"));
        //baseMap.put("faceCap",targetAttrs.getIntValue("faceCap"));

        for (int j=0;j<targetList.size();j++){
            JSONObject target = (JSONObject) targetList.get(j);
            Map<String, Object> map = JSONObject.parseObject(JSONObject.toJSONString(target), Map.class);
            JSONArray jsonArray = target.getJSONArray("frame");
            StringBuilder sb = new StringBuilder();
            for (int i=0;i< jsonArray.size();i++){
                JSONObject jsonObject = jsonArray.getJSONObject(i);
                JSONObject rect = jsonObject.getJSONObject("rect");
                sb.append(rect.getString("x"));sb.append(",");
                sb.append(rect.getString("y"));sb.append(",");
                sb.append(rect.getString("w"));sb.append(",");
                sb.append(rect.getString("h"));sb.append(",");
                sb.append(jsonObject.getLongValue("absStamp"));sb.append(",");
                sb.append(jsonObject.getLongValue("frameNum"));
                if (i<jsonArray.size()-1) sb.append(";");
            }
            map.put("targetTrack",sb.toString());
            map.remove("frame");
            map.putAll(baseMap);
            if (map.keySet().contains("linkFaceBodyGaitId"))
                map.put("linkFaceBodyGaitId",map.get("linkFaceBodyGaitId"));
    }
    }

        static String ss = "{\"ipAddress\":\"10.244.0.120\",\"ipv6Address\":\"\",\"portNo\":\"\",\"protocol\":\"HTTP\",\"macAddress\":\"\",\"eventType\":\"gaitResult\",\"eventDescription\":\"gaitResult\",\"analysisResult\":[{\"taskID\":\"temp_a343e756ddd44baf8530d8b64369b8b2\",\"targetAttrs\":{\"regionIndexCode\":\"4420cce5a947438f9a382fd8ad41d132\",\"areaCode\":\"4420cce5a947438f9a382fd8ad41d132\",\"transmission\":{\"taskIds\":\"f66cfd52c0da4f12879c4f47e096772c\"},\"recognitionSign\":2,\"mainTaskId\":\"304b27141a2945a2a5a0a366aa8d4c8e\",\"videoStructure\":1,\"crossingId\":1,\"cameraIndexCode\":\"947fd2e554fa471cb0930e7606067882\",\"analysisType\":\"realtime\",\"timeZone\":28800,\"faceCap\":0},\"target\":[{\"model\":\"AQAAAECQAAQAAAAAAAAAAAAAAABAkAAEAAHyCvsAAP/4/ATw+wAK+vsMCAP6+v77/gD7BgIADAUHBvr6/RQBAAIAA/fx/fn4/QMHAf38+/j8+AAI+Ar6B/32DAUK+vwBAPUI+/IPBfMD+e76AAgACgUKDQcJCwf09vkE/QL1AwAK+wcB+P4H+AH4Av0C+w0L/fIQ/AoG8gD4Awr8+gYIBfoE+wAD//wI+wACAwAFAvv7CfwFBwgAAPr8BQL6BAYKBfAB8gEA/QAGCgMHD/kACgEL/QoH+AAI/BYBAPgA/PYDAvn/AgX2Afz59wAEAAoMAPnzAAj2Avf3BgULC//x8QABBgUIBQgL+An2/u7+9P8C/gTvBAj6DBD/\",\"startTime\":1579405155400,\"endTime\":1579405157360,\"targetRect\":\"{\\\"x\\\":0.415625,\\\"y\\\":0.065741,\\\"w\\\":0.032292,\\\"h\\\":0.129630}\",\"timeStamp\":1579405155400,\"recordUrl\":\"rtsp://10.19.173.48:655/EUrl/af8818I&dactoken=SElLIE1ZQzJScWt6ZGpJaFh4Wkk6MzJpZlRLUGdQbUFmQm5sN0l2bUVVT1Yza2tzWVN6bnc0Nk5GLzRVdzAyTT06MTU3OTI3MDMyMTEyOA==\",\"traceUuid\":\"BBBC0DB88319448DB9C8C2EB67206C10\",\"linkFaceBodyGaitId\":\"BBBC0DB88319448DB9C8C2EB67206C10\",\"frame\":\"[{\\\"timeStamp\\\":4286623680,\\\"absStamp\\\":1579405155400,\\\"frameNum\\\":3370549,\\\"rect\\\":{\\\"x\\\":0.415625,\\\"y\\\":0.065741,\\\"w\\\":0.032292,\\\"h\\\":0.129630}},{\\\"timeStamp\\\":4286623720,\\\"absStamp\\\":1579405155440,\\\"frameNum\\\":3370550,\\\"rect\\\":{\\\"x\\\":0.415625,\\\"y\\\":0.067593,\\\"w\\\":0.033333,\\\"h\\\":0.126852}},{\\\"timeStamp\\\":4286623760,\\\"absStamp\\\":1579405155480,\\\"frameNum\\\":3370551,\\\"rect\\\":{\\\"x\\\":0.416667,\\\"y\\\":0.062963,\\\"w\\\":0.034375,\\\"h\\\":0.132407}},{\\\"timeStamp\\\":4286623800,\\\"absStamp\\\":1579405155520,\\\"frameNum\\\":3370552,\\\"rect\\\":{\\\"x\\\":0.415625,\\\"y\\\":0.068519,\\\"w\\\":0.036458,\\\"h\\\":0.125926}},{\\\"timeStamp\\\":4286623840,\\\"absStamp\\\":1579405155560,\\\"frameNum\\\":3370553,\\\"rect\\\":{\\\"x\\\":0.419792,\\\"y\\\":0.060185,\\\"w\\\":0.032292,\\\"h\\\":0.135185}},{\\\"timeStamp\\\":4286623880,\\\"absStamp\\\":1579405155600,\\\"frameNum\\\":3370554,\\\"rect\\\":{\\\"x\\\":0.420833,\\\"y\\\":0.060185,\\\"w\\\":0.032292,\\\"h\\\":0.135185}},{\\\"timeStamp\\\":4286623920,\\\"absStamp\\\":1579405155640,\\\"frameNum\\\":3370555,\\\"rect\\\":{\\\"x\\\":0.420833,\\\"y\\\":0.060185,\\\"w\\\":0.032292,\\\"h\\\":0.135185}},{\\\"timeStamp\\\":4286623960,\\\"absStamp\\\":1579405155680,\\\"frameNum\\\":3370556,\\\"rect\\\":{\\\"x\\\":0.425000,\\\"y\\\":0.060185,\\\"w\\\":0.030208,\\\"h\\\":0.135185}},{\\\"timeStamp\\\":4286624000,\\\"absStamp\\\":1579405155720,\\\"frameNum\\\":3370557,\\\"rect\\\":{\\\"x\\\":0.425000,\\\"y\\\":0.062963,\\\"w\\\":0.031250,\\\"h\\\":0.131481}},{\\\"timeStamp\\\":4286624040,\\\"absStamp\\\":1579405155760,\\\"frameNum\\\":3370558,\\\"rect\\\":{\\\"x\\\":0.425000,\\\"y\\\":0.062963,\\\"w\\\":0.031250,\\\"h\\\":0.126852}},{\\\"timeStamp\\\":4286624080,\\\"absStamp\\\":1579405155800,\\\"frameNum\\\":3370559,\\\"rect\\\":{\\\"x\\\":0.425000,\\\"y\\\":0.062963,\\\"w\\\":0.032292,\\\"h\\\":0.126852}},{\\\"timeStamp\\\":4286624120,\\\"absStamp\\\":1579405155840,\\\"frameNum\\\":3370560,\\\"rect\\\":{\\\"x\\\":0.425000,\\\"y\\\":0.062037,\\\"w\\\":0.033333,\\\"h\\\":0.126852}},{\\\"timeStamp\\\":4286624160,\\\"absStamp\\\":1579405155880,\\\"frameNum\\\":3370561,\\\"rect\\\":{\\\"x\\\":0.427083,\\\"y\\\":0.062037,\\\"w\\\":0.031250,\\\"h\\\":0.123148}},{\\\"timeStamp\\\":4286624200,\\\"absStamp\\\":1579405155920,\\\"frameNum\\\":3370562,\\\"rect\\\":{\\\"x\\\":0.423958,\\\"y\\\":0.062037,\\\"w\\\":0.034375,\\\"h\\\":0.125000}},{\\\"timeStamp\\\":4286624240,\\\"absStamp\\\":1579405155960,\\\"frameNum\\\":3370563,\\\"rect\\\":{\\\"x\\\":0.427083,\\\"y\\\":0.060185,\\\"w\\\":0.032292,\\\"h\\\":0.126852}},{\\\"timeStamp\\\":4286624280,\\\"absStamp\\\":1579405156000,\\\"frameNum\\\":3370564,\\\"rect\\\":{\\\"x\\\":0.426042,\\\"y\\\":0.058333,\\\"w\\\":0.033333,\\\"h\\\":0.129630}},{\\\"timeStamp\\\":4286624320,\\\"absStamp\\\":1579405156040,\\\"frameNum\\\":3370565,\\\"rect\\\":{\\\"x\\\":0.431250,\\\"y\\\":0.060185,\\\"w\\\":0.030208,\\\"h\\\":0.125926}},{\\\"timeStamp\\\":4286624360,\\\"absStamp\\\":1579405156080,\\\"frameNum\\\":3370566,\\\"rect\\\":{\\\"x\\\":0.431250,\\\"y\\\":0.062963,\\\"w\\\":0.030208,\\\"h\\\":0.119444}},{\\\"timeStamp\\\":4286624400,\\\"absStamp\\\":1579405156120,\\\"frameNum\\\":3370567,\\\"rect\\\":{\\\"x\\\":0.430208,\\\"y\\\":0.060185,\\\"w\\\":0.031250,\\\"h\\\":0.121296}},{\\\"timeStamp\\\":4286624440,\\\"absStamp\\\":1579405156160,\\\"frameNum\\\":3370568,\\\"rect\\\":{\\\"x\\\":0.431250,\\\"y\\\":0.056481,\\\"w\\\":0.028125,\\\"h\\\":0.123148}},{\\\"timeStamp\\\":4286624480,\\\"absStamp\\\":1579405156200,\\\"frameNum\\\":3370569,\\\"rect\\\":{\\\"x\\\":0.433333,\\\"y\\\":0.045370,\\\"w\\\":0.025000,\\\"h\\\":0.131481}},{\\\"timeStamp\\\":4286624520,\\\"absStamp\\\":1579405156240,\\\"frameNum\\\":3370570,\\\"rect\\\":{\\\"x\\\":0.433333,\\\"y\\\":0.050926,\\\"w\\\":0.027083,\\\"h\\\":0.123148}},{\\\"timeStamp\\\":4286624560,\\\"absStamp\\\":1579405156280,\\\"frameNum\\\":3370571,\\\"rect\\\":{\\\"x\\\":0.434375,\\\"y\\\":0.058333,\\\"w\\\":0.028125,\\\"h\\\":0.116667}},{\\\"timeStamp\\\":4286624600,\\\"absStamp\\\":1579405156320,\\\"frameNum\\\":3370572,\\\"rect\\\":{\\\"x\\\":0.435417,\\\"y\\\":0.053704,\\\"w\\\":0.028125,\\\"h\\\":0.119444}},{\\\"timeStamp\\\":4286624640,\\\"absStamp\\\":1579405156360,\\\"frameNum\\\":3370573,\\\"rect\\\":{\\\"x\\\":0.435417,\\\"y\\\":0.053704,\\\"w\\\":0.028125,\\\"h\\\":0.119444}},{\\\"timeStamp\\\":4286624680,\\\"absStamp\\\":1579405156400,\\\"frameNum\\\":3370574,\\\"rect\\\":{\\\"x\\\":0.436458,\\\"y\\\":0.058333,\\\"w\\\":0.029167,\\\"h\\\":0.113889}},{\\\"timeStamp\\\":4286624760,\\\"absStamp\\\":1579405156480,\\\"frameNum\\\":3370576,\\\"rect\\\":{\\\"x\\\":0.438542,\\\"y\\\":0.050926,\\\"w\\\":0.028125,\\\"h\\\":0.115741}},{\\\"timeStamp\\\":4286624800,\\\"absStamp\\\":1579405156520,\\\"frameNum\\\":3370577,\\\"rect\\\":{\\\"x\\\":0.439583,\\\"y\\\":0.050926,\\\"w\\\":0.026042,\\\"h\\\":0.115741}},{\\\"timeStamp\\\":4286624840,\\\"absStamp\\\":1579405156560,\\\"frameNum\\\":3370578,\\\"rect\\\":{\\\"x\\\":0.440625,\\\"y\\\":0.050926,\\\"w\\\":0.026042,\\\"h\\\":0.115741}},{\\\"timeStamp\\\":4286624880,\\\"absStamp\\\":1579405156600,\\\"frameNum\\\":3370579,\\\"rect\\\":{\\\"x\\\":0.441667,\\\"y\\\":0.043519,\\\"w\\\":0.026042,\\\"h\\\":0.123148}},{\\\"timeStamp\\\":4286624920,\\\"absStamp\\\":1579405156640,\\\"frameNum\\\":3370580,\\\"rect\\\":{\\\"x\\\":0.442708,\\\"y\\\":0.045370,\\\"w\\\":0.026042,\\\"h\\\":0.116667}},{\\\"timeStamp\\\":4286624960,\\\"absStamp\\\":1579405156680,\\\"frameNum\\\":3370581,\\\"rect\\\":{\\\"x\\\":0.441667,\\\"y\\\":0.045370,\\\"w\\\":0.025000,\\\"h\\\":0.111111}},{\\\"timeStamp\\\":4286625000,\\\"absStamp\\\":1579405156720,\\\"frameNum\\\":3370582,\\\"rect\\\":{\\\"x\\\":0.442708,\\\"y\\\":0.047222,\\\"w\\\":0.027083,\\\"h\\\":0.111111}},{\\\"timeStamp\\\":4286625040,\\\"absStamp\\\":1579405156760,\\\"frameNum\\\":3370583,\\\"rect\\\":{\\\"x\\\":0.442708,\\\"y\\\":0.047222,\\\"w\\\":0.028125,\\\"h\\\":0.110185}},{\\\"timeStamp\\\":4286625080,\\\"absStamp\\\":1579405156800,\\\"frameNum\\\":3370584,\\\"rect\\\":{\\\"x\\\":0.443750,\\\"y\\\":0.043519,\\\"w\\\":0.029167,\\\"h\\\":0.115741}},{\\\"timeStamp\\\":4286625120,\\\"absStamp\\\":1579405156840,\\\"frameNum\\\":3370585,\\\"rect\\\":{\\\"x\\\":0.443750,\\\"y\\\":0.040741,\\\"w\\\":0.027083,\\\"h\\\":0.121296}},{\\\"timeStamp\\\":4286625160,\\\"absStamp\\\":1579405156880,\\\"frameNum\\\":3370586,\\\"rect\\\":{\\\"x\\\":0.445833,\\\"y\\\":0.039815,\\\"w\\\":0.025000,\\\"h\\\":0.119444}},{\\\"timeStamp\\\":4286625200,\\\"absStamp\\\":1579405156920,\\\"frameNum\\\":3370587,\\\"rect\\\":{\\\"x\\\":0.444792,\\\"y\\\":0.039815,\\\"w\\\":0.027083,\\\"h\\\":0.119444}},{\\\"timeStamp\\\":4286625240,\\\"absStamp\\\":1579405156960,\\\"frameNum\\\":3370588,\\\"rect\\\":{\\\"x\\\":0.446875,\\\"y\\\":0.043519,\\\"w\\\":0.028125,\\\"h\\\":0.113889}},{\\\"timeStamp\\\":4286625280,\\\"absStamp\\\":1579405157000,\\\"frameNum\\\":3370589,\\\"rect\\\":{\\\"x\\\":0.446875,\\\"y\\\":0.043519,\\\"w\\\":0.029167,\\\"h\\\":0.113889}},{\\\"timeStamp\\\":4286625320,\\\"absStamp\\\":1579405157040,\\\"frameNum\\\":3370590,\\\"rect\\\":{\\\"x\\\":0.445833,\\\"y\\\":0.043519,\\\"w\\\":0.032292,\\\"h\\\":0.113889}},{\\\"timeStamp\\\":4286625360,\\\"absStamp\\\":1579405157080,\\\"frameNum\\\":3370591,\\\"rect\\\":{\\\"x\\\":0.446875,\\\"y\\\":0.047222,\\\"w\\\":0.027083,\\\"h\\\":0.108333}},{\\\"timeStamp\\\":4286625400,\\\"absStamp\\\":1579405157120,\\\"frameNum\\\":3370592,\\\"rect\\\":{\\\"x\\\":0.446875,\\\"y\\\":0.045370,\\\"w\\\":0.027083,\\\"h\\\":0.105556}},{\\\"timeStamp\\\":4286625440,\\\"absStamp\\\":1579405157160,\\\"frameNum\\\":3370593,\\\"rect\\\":{\\\"x\\\":0.445833,\\\"y\\\":0.040741,\\\"w\\\":0.032292,\\\"h\\\":0.113889}},{\\\"timeStamp\\\":4286625480,\\\"absStamp\\\":1579405157200,\\\"frameNum\\\":3370594,\\\"rect\\\":{\\\"x\\\":0.447917,\\\"y\\\":0.040741,\\\"w\\\":0.029167,\\\"h\\\":0.111111}},{\\\"timeStamp\\\":4286625520,\\\"absStamp\\\":1579405157240,\\\"frameNum\\\":3370595,\\\"rect\\\":{\\\"x\\\":0.447917,\\\"y\\\":0.040741,\\\"w\\\":0.029167,\\\"h\\\":0.110185}},{\\\"timeStamp\\\":4286625560,\\\"absStamp\\\":1579405157280,\\\"frameNum\\\":3370596,\\\"rect\\\":{\\\"x\\\":0.446875,\\\"y\\\":0.037963,\\\"w\\\":0.033333,\\\"h\\\":0.111111}},{\\\"timeStamp\\\":4286625600,\\\"absStamp\\\":1579405157320,\\\"frameNum\\\":3370597,\\\"rect\\\":{\\\"x\\\":0.451042,\\\"y\\\":0.040741,\\\"w\\\":0.027083,\\\"h\\\":0.110185}},{\\\"timeStamp\\\":4286625640,\\\"absStamp\\\":1579405157360,\\\"frameNum\\\":3370598,\\\"rect\\\":{\\\"x\\\":0.453125,\\\"y\\\":0.049074,\\\"w\\\":0.023958,\\\"h\\\":0.099074}}]\",\"bkgUrl\":\"http://10.19.173.7:6120/pic?AC01F06B0740B00C68AE*123456789/01234/15258;15793897378393775578?pic*583420850*191203*3068*AC01F06B0740B00C68AE-2*1579405121\",\"picUrl\":\"http://10.19.173.7:6120/pic?AC01F06B0740B00C68AE*123456789/01234/15258;15793897379733495579?pic*29611544*9410*3049*AC01F06B0740B00C68AE-2*1579405121\"}],\"algorithmType\":7}]}";
}
